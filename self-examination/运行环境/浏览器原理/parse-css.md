## 浏览器如何解析 CSS 规则，并将其应用到 DOM 树上

浏览器解析 CSS 规则并将其应用到 DOM 树上的过程称为 CSS 渲染流程，这个过程涉及了多个步骤，用于确定每个元素的最终样式，以便在渲染树中进行布局和绘制。以下是浏览器浏览器解析 CSS 规则并且应用到 DOM 树上的基本流程：

1. 获取样式表：浏览器在解析 HTML 时，会识别并获取样式表，包括外部样式表（`link` 标签）、嵌入式样式（`style` 标签）和内敛样式（元素的 `style` 属性）

2. 构建 CSSOM 树：浏览器将获取到的样式转换为 CSSOM 树（CSS 对象模拟树）。CSSOM 树表示了样式规则、选择器和属性的层次结构

3. 匹配元素和规则：浏览器遍历 DOM 树中的每个元素，并将其与 CSSOM 树中的样式规则进行匹配。这涉及选择器的解析和匹配，确定哪些规则适用于哪些元素

4. 计算最终样式：对于每个匹配的元素，浏览器都会计算出最终的样式，包括继承样式、层叠样式和特定元素样式的计算

5. 生成渲染树：浏览器将 DOM 树和计算后的样式信息（包括继承和特定的样式）合并，生成渲染树（Render Tree），渲染树包含了需要在页面上显示的元素及其样式信息

6. 布局（Layout）：基于渲染树，浏览器进行布局，计算每个元素在屏幕上的大小和位置，以及它们之间的相对关系，这个过程也成为重排（Reflow）

7. 绘制（Painting）：根据布局计算，浏览器将元素绘制到屏幕上，生成页面的视觉呈现，这个过程也称为重回（Repaint）

8. 显示页面：经过布局和绘制，浏览器最终将渲染的页面显示给用户，用户可以在浏览器窗口中看到页面内容

整个 CSS 渲染流程的目标是为每个元素确定最终的样式，以便在页面渲染时正确地进行布局和绘制，这个过程中，浏览器需要处理样式继承、选择器权重、层叠规则等复杂性，以确保页面呈现出正确的外观和交互效果。同时，对于一些性能优化，如避免布局抖动和减少重拍等，也会在这个过程中进行
