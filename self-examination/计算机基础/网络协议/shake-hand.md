## 三次握手和四次挥手详细原理，为什么要使用这种机制

三次握手和四次挥手是 TCP（Transmission Control Protocol）连接的建立和断开过程中使用的协议机制。它们的主要目的是确保可靠的数据传输和连接的可靠性

### 三次握手（Three-Way Handshake）

1. 第一步：客户端向服务器发送 SYN（同步）报文
   客户端发起连接请求，向服务器发送一个带有 SYN 标志的报文段，其中包含一个随机生成的序列号（SYN=1，seq=x）

2. 第二步：服务器收到 SYN 报文后，向客户端发送 SYN-ACK 报文。
   服务器收到客户端的 SYN 报文后，确认客户端的请求，向客户端发送一个带有 SYN 和 ACK（确认）标志的报文段（SYN=1，ACK=1，seq=y，ack=x+1）

3. 第三步：客户端收到 SYN-ACK 报文后，向服务器发送 ACK 报文
   客户端收到服务器的 SYN-ACK 报文后，向服务器发送一个带有 ACK 标志的报文段（ACK=1，seq=x+1，ack=y+1）

完成以上三步握手后，TCP 连接建立，双方可以开始进行数据传输

### 四次挥手（Four-Way Handshake）：

1. 第一步：客户端向服务器发送 FIN（结束）报文
   客户端发送一个带有 FIN 标志的报文段，表示客户端已经没有数据要发送了（FIN=1，seq=u）

2. 第二步：服务器收到 FIN 报文后，向客户端发送 ACK 报文
   服务器收到客户端的 FIN 报文后，向客户端发送一个确认报文段（ACK=1，ack=u+1）

3. 第三步：服务器向客户端发送 FIN 报文
   服务器也通知客户端，服务器没有数据要发送了，向客户端发送一个带有 FIN 标志的报文段（FIN=1，seq=v）

4. 第四步：客户端收到服务器的 FIN 报文后，向服务器发送 ACK 报文
   客户端收到服务器的 FIN 报文后，发送一个确认报文段（ACK=1，ack=v+1）

完成以上四步挥手后，TCP 连接断开，双方不再进行数据传输

### 为什么要使用这种机制？

三次握手和四次挥手的机制是为了保证数据传输的可靠性和连接的完整性

在建立连接时，三次握手确保了双方都能够收到对方的连接请求和确认，以建立可靠的双向通信通道

在断开连接时，四次挥手确保了双方都能够知道对方已经结束数据传输，并最终断开连接。这样可以确保所有数据都被完整传输和接收，同时释放相关资源以避免资源浪费

使用三次握手和四次挥手的机制可以解决以下问题：

- 可靠性：通过多次的握手和确认过程，确保双方都愿意建立连接或断开连接，减少因网络问题导致的错误连接或断开

- 数据完整性：在建立连接和断开连接时，通过确认报文的交互，确保数据的完整性，避免数据的丢失或不完整

- 避免资源浪费：在断开连接时，通过四次挥手的过程，确保双方都结束了数据传输并释放了相关资源，避免资源的持续占用

总之，三次握手和四次挥手机制是 TCP 协议中的重要部分，通过这种机制可以保证连接的可靠性和数据的完整性，同时有效地管理和释放网络资源
