## Javascript 如何实现异步编程，可以详细描述 `EventLoop` 机制

Javascript 是一种单线程语言，这意味着它一次只能执行一个任务。为了处理耗时的任务而不阻塞主进程，Javascript 提供了异步编程的能力。异步编程允许代码在等待异步操作（如 I/O、网络请求等）完成的同时，继续执行后续任务。Javascript 实现异步编程的主要机制包括回调函数、Promises、async/await 以及事件循环（Event Loop）

### 异步编程的方法

- 回调函数（Callbacks）

  回调函数是最早期的异步编程方法，通过将函数作为参数传递给另一个函数，然后在异步操作完成时执行这个回调函数。但其的缺点为可能会导致回调地狱（Callback Hell），使代码难以阅读和维护

- Promise

  为了解决回调地狱的问题，Promise 被引入，Promise 是一个代表异步操作最终完成或失败的对象。其提供 `.then()` 和 `.catch()` 方法来分别处理成功和失败的情况。Promise 的出现也使得异步代码更加易于组织和理解

- Async/Await

  基于 Promise 的语法糖，使异步代码看起来更像同步代码，`async` 关键字用于声明一个异步函数，`await` 关键字用于等待一个异步操作的结果。`async/await` 提高了代码的可读性和编写的简洁性

### 事件循环（Event Loop）

事件循环时 Javascript 异步编程的核心机制，尤其是在 Node.js 和浏览器环境中

- 工作原理

  - 堆和栈

    Javascript 使用堆存储对象，栈存储执行上下文（函数调用）

  - 事件队列

    当异步事件发生时，如点击事件或 HTTP 请求，相关的回调函数被放入事件队列（Event Queue）中

  - 事件循环的角色

    事件循环不断检查调用栈是否为空。当调用栈为空时，事件循环会从事件队列中取出回调函数并放入调用栈中执行

  - 宏任务和微任务

    Javascript 引擎区分宏任务和微任务，微任务（如 Promise 回调）在每个宏任务（如 setTimeout）之后执行

- 过程

  1. 执行全局脚本代码，这些代码在调用栈中运行

  2. 当异步函数被调用，例如 `setTimeout`，其回调被添加到事件队列中

  3. 当调用栈中的所有同步代码执行完毕，事件循环开始工作

  4. 如果事件队列中有待处理的事件（宏任务），事件循环将它们一个接一个地放入调用栈中执行

  5. 在每个宏任务之间，事件循环会检查微任务队列并执行所有微任务，这包括 Promise 回调等

  6. 这个过程不断重复，直到调用栈和事件队列都为空
