## 宏任务和微任务分别有哪些

宏任务 (Macro Tasks) 和微任务 (Micro Tasks) 是 Javascript 中用于管理异步操作的概念，他们有着不同的特点和执行顺序

### 宏任务

宏任务是在下一个事件循环迭代（tick）中执行的任务。每个宏任务都会开启一个新的事件循环

- 浏览器环境中的宏任务

  - `setTimeout` 和 `setInterval`：定时器函数，延迟执行或定期执行回调函数

  - UI 渲染：浏览器的 UI 重绘（repaint）和回流（reflow）任务

  - 事件处理：用户交互事件（如点击、滚动等）的处理

  - I/O：例如 `fetch`、`XMLHttoRequest` 等网络请求的回调

  - `postMessage`：跨文档通信或者 Worker 间通信的方法

  - `requestAnimationFrame`：动画帧请求回调

- Node.js 环境中的宏任务包括

  - `setTimeout` 和 `setInterval`：与浏览器中类似，用于定时执行回调

  - `setImmediate`：专门用于 Node.js 的异步 API，安排在事件循环的下一个迭代中执行

  - I/O：如文件操作系统、网络请求的回调

### 微任务

微任务通常在当前事件循环迭代结束后，下一个宏任务开始前立即执行

- 浏览器中的微任务

  - `Promise` 的回调函数

  - `MutationObserver`：监听 DOM 变化的回调函数

- Node.js 环境中的微任务

  - `process.nextTick`：特定于 Node.js，它允许在事件循环的当前阶段结束后立即执行回调

  - `Promise` 的回调函数

### 浏览器环境异步任务执行步骤

1. 执行全局脚本

2. 处理宏任务

3. 检查是否有微任务，如果有则依次执行所有微任务

4. 更新渲染

5. 执行下一个宏任务（从宏任务队列中取出）

### Node 环境异步任务执行步骤

1. 执行全局脚本

2. 处理宏任务

3. 事件循环阶段
   Node.js 的事件循环包含多个阶段，每个阶段对应不同的任务队列，例如 timers 阶段处理定时器回调，I/O 回调阶段处理大多数 I/O 相关的回调等

4. 执行微任务

5. 进入下一个循环阶段
