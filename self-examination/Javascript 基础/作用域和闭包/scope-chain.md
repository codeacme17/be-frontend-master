## 理解 Javascript 的作用域和作用域链

作用域（Scope）和作用域链（Scope Chain）的概念涉及变量的可见性和声明周期，以及在代码不同部分如何访问这些变量

### 作用域

- 定义

  作用域是一个编程概念，定义了变量和函数在代码中的可访问性，在 Javascript 中，一个变量或函数可以在当前代码执行环境中访问，就说它在当前作用域中

- 类型

  - 全局作用域

    在代码的最外层定义的变量处于全局作用域，它们在代码的任何部分都可被访问

  - 函数作用域

    在函数内部定义的变量处于该函数的作用域中，只能在干函数内部访问

  - 块级作用域（ES6 引入）

    由 `{}` 包裹的区域形成的块级作用域，使用 `let` 和 `const` 声明的变量遵循块级作用域

- 词法作用域

  Javascript 遵循词法作用域（也成为静态作用域），意味着函数的作用域在函数定义时就已经确定了，而不是执行时确定

### 作用域链

- 定义

  当代码在一个环境执行时，Javascript 会查找变量的值，因此，它会使用作用域链来查找变量的定义。作用域链是一个逐级向外层作用域查找变量的过程

- 工作原理

  - 在一个函数中访问变量时，Javascript 首先在当前函数的作用域内查找

  - 如果在当前作用域中没有找到，它会通过 `[[scope]]` 指针查找被定义时的词法环境

  - 这个过程会一直持续到全局作用域，如果在全局作用域中没有找到，将会报引用错误（ReferenceError）

### `[[scope]]`

`[[scope]]` 是一个内部属性，用于指定函数的作用域链，在函数被定义时生成。这个属性对于理解闭包、作用域链，以及函数在执行时如何访问变量非常重要。但要注意的是，`[[scope]]` 并不是一个可以在 Javascript 中直接访问或操作的属性，它属于 Javascript 引擎的内部实现细节，其作用有

- 存储词法环境

  当函数被创建时，Javascript 引擎会为这个函数设置一个 `[[scope]]` 属性，这个属性包含了函数定义时的词法环境。这个环境包含了函数定义时可访问的所有变量，这些变量可能是局部的（在函数内定义的），也有可能是外部的（在外层作用域中定义的）

- 解析变量和函数名

  当函数执行时，他需要访问变量和其他函数，Javascript 引擎使用 `[[scope]]` 属性来确定这些标识符的位置。通过 `[[scope]]`，函数可以访问它被定义时的环境中的变量，即使这个函数在不同的环境中被调用

- 闭包的实现

  - 当函数引用了定义他们的词法环境之外的变量时，就形成了闭包。在闭包中，函数可以访问并操作这些外部变量，即使它们在定义这些变量的环境之外执行

  - 因为 `[[scope]]` 包含了函数定义时的环境，所以即使函数在不同的上下文中执行，它仍然能访问那个环境中的变量。这就是闭包的核心机制
