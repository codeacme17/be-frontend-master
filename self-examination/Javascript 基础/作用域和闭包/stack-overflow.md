## 理解堆栈溢出和内存泄漏的原理，以及如何防止

### 堆栈溢出

堆栈溢出指的是程序在执行时，当调用函数时，会在栈内存中为该函数分配一定的空间，该空间由编译器分配，然后在函数执行完成后自动回收。当递归调用的次数过多，或者在函数中创建了大量的对象或数组等占用大量内存的数据结构时，可能会导致堆栈内存空间不够，从而发生堆栈溢出错误

```js
function overflow() {
  while (true) {
    overflow()
  }
}
```

### 内存泄漏

内存泄漏指程序中分配的内存由于某种原因没有被释放或无法被释放，导致程序不再能够使用哪部分内存。在 Web 开发中，内存泄漏可能导致应用变慢甚至崩溃，尤其是在长时间运行的应用中更为常见。以下是导致内存泄漏原因和场景

- 全局变量

  无意中创建的全局变量可以导致内存泄漏。例如，在不使用 `var`、`let` 或 `const` 直接赋值变量时，该变量自动成为全局对象的属性。由于全局对象（在浏览器中是 `window` 对象）的生命周期与应用相同，这会导致其所引用的内存知道应用结束后才被释放

- 未清理的计时器或会掉函数

  设置了 `setInterval` 或 `setTimeout` 但未在不需要时通过 `clearInterval` 或 `clearTimeout` 清除，可以导致内存泄漏，尤其是当回调函数引用了 DOM 元素或其他资源时

- 闭包

  闭包可以让你访问定义在外部函数中的变量，不正当的使用闭包可能会导致父函数的作用域链无法被回收，尤其是当闭包被长时间保留时

- DOM 引用

  如果在 Javascript 对象中保存了对 DOM 元素的引用，然后从文档中移除了这些元素，但没有清理引用，这些 DOM 元素将不会被回收

- 事件监听器

  在 DOM 元素上注册事件监听器但未在不需要时已出，特别是当元素被移除时，如果监听器仍然存在，它们可能会成为内存泄露的来源

- 第三方库

  使用内存泄露问题的第三方库也可能导致应用出现内存泄露

#### 如何避免内存泄露

- 使用局部变量：尽量使用局部变量，避免无意中创建全局变量

- 及时清理：使用完计时器、事件监听器或其他形式的回调后，及时清理

- 限制闭包使用：谨慎使用闭包，确保不会无意间保留哦过多的数据

- 分离 DOM 和 Javascript：在从 DOM 中移除元素时，确保移除与之相关联的 Javascript 引用和事件监听器

- 工具检测：使用浏览器的开发者工具进行内存泄漏检测，定期对应用进行分析和测试
